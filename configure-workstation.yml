---
- name: Configure workstation VM
  hosts: localhost
  tasks:
    - name: Install software
      dnf:
        name:
          - gnome-tweaks
        state: latest

    - name: Customize .vimrc
      copy:
        content: "set ai et ts=2 sts=2 sw=2 colorcolumn=80"
        dest: /home/{{ local_user }}/.vimrc
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0664

    - name: Make Regular Directories
      file:
        path: "{{ item }}"
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0775
      loop:
        - /home/{{ local_user }}/bin
        
    - name: Make Secure Directories
      file:
        path: "{{ item }}"
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0700
      loop:
        - /home/{{ local_user }}/.config
        
    - name: Configure aliases
      blockinfile:
        path: /home/{{ local_user }}/.bashrc
        marker: "# {mark} ANSIBLE MANAGED BLOCK ALIASES"
        block: "{{ lookup('file', 'files/bashrc_aliases') }}"
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0644
        state: present

    - name: Set display resolution to 1280 x 1024
      copy:
        src: files/monitors.xml
        dest: /home/{{ local_user }}/.config/
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0600

    - name: Copy my-gsettings.sh
      copy:
        src: files/my-gsettings.sh
        dest: /home/{{ local_user }}/bin/
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        mode: 0775

    - name: Run gsettings
      become: true
      become_user: "{{ local_user }}"
      command: /home/{{ local_user }}/bin/my-gsettings.sh
      changed_when: false

    - name: Install local RPMs for aspell and ascii-doc
      dnf:
        name:
          - files/a2g-0.1.7-1.el8.noarch.rpm
          - files/aspell-asciidoc-0.1-2.el8.x86_64.rpm
          - files/rubygem-asciidoctor-1.5.6.1-6.fc30.noarch.rpm
        state: installed

    - name: Apply additional ~/.aspell.conf configuration
      blockinfile:
        path: /home/{{ local_user }}/.aspell.conf
        owner: "{{ local_user }}"
        group: "{{ local_user }}"
        block: |
          #add-asciidoc-blocks ====
          add-asciidoc-tags *
          add-asciidoc-macros
          
