---
- name: Configure workstation VM
  hosts: localhost
  vars:
    git:
      - name: user.name
        value: Michael Phillips
      - name: user.email
        value: miphilli@redhat.com
      - name: push.default
        value: simple
      - name: credential.https://github.com.username
        value: angelesphillips
  tasks:
    - name: Install software
      dnf:
        name:
          - gnome-tweaks
          - python3-psutil
        state: latest

    - name: Customize .vimrc
      copy:
        content: "set ai et ts=2 sts=2 sw=2 colorcolumn=80"
        dest: /home/{{ ansible_env['USERNAME'] }}/.vimrc
        owner: "{{ ansible_env['USERNAME'] }}"
        group: "{{ ansible_env['USERNAME'] }}"
        mode: 0664

    - name: Make Regular Directories
      file:
        path: "{{ item }}"
        state: directory
        owner: "{{ ansible_env['USERNAME'] }}"
        group: "{{ ansible_env['USERNAME'] }}"
        mode: 0775
      loop:
        - /home/{{ ansible_env['USERNAME'] }}/bin

    - name: Make Secure Directories
      file:
        path: "{{ item }}"
        state: directory
        owner: "{{ ansible_env['USERNAME'] }}"
        group: "{{ ansible_env['USERNAME'] }}"
        mode: 0700
      loop:
        - /home/{{ ansible_env['USERNAME'] }}/.config

    - name: Configure aliases
      blockinfile:
        path: /home/{{ ansible_env['USERNAME'] }}/.bashrc
        marker: "# {mark} ANSIBLE MANAGED BLOCK ALIASES"
        block: "{{ lookup('file', 'files/bashrc_aliases') }}"
        owner: "{{ ansible_env['USERNAME'] }}"
        group: "{{ ansible_env['USERNAME'] }}"
        mode: 0644
        state: present

    # No longer works
    #- name: Set display resolution to 1280 x 1024
    #  copy:
    #    src: files/monitors.xml
    #    dest: /home/{{ ansible_env['USERNAME'] }}/.config/
    #    owner: "{{ ansible_env['USERNAME'] }}"
    #    group: "{{ ansible_env['USERNAME'] }}"
    #    mode: 0600

    - name: Use 12-hour clock format instead of 24-hour
      become: true
      become_user: "{{ ansible_env['USERNAME'] }}"
      dconf:
        key: "/org/gnome/desktop/interface/clock-format"
        value: "'12h'"

    - name: Display seconds in the top-bar clock
      become: true
      become_user: "{{ ansible_env['USERNAME'] }}"
      dconf:
        key: "/org/gnome/desktop/interface/clock-show-seconds"
        value: "true"

    - name: Enable the gnome-tweaks extension that shows the window list
      become: true
      become_user: "{{ ansible_env['USERNAME'] }}"
      dconf:
        key: "/org/gnome/shell/enabled-extensions"
        value: "['window-list@gnome-shell-extensions.gcampax.github.com']"

    - name: Turn off keyboard repeats
      become: true
      become_user: "{{ ansible_env['USERNAME'] }}"
      dconf:
        key: "/org/gnome/desktop/peripherals/keyboard/repeat"
        value: "false"

    - name: Set favorites
      become: true
      become_user: "{{ ansible_env['USERNAME'] }}"
      dconf:
        key: "/org/gnome/shell/favorite-apps"
        value: "['firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Terminal.desktop']"

    - name: Configure basic git settings
      become: yes
      become_user: "{{ local_user }}"
      git_config:
        scope: global
        name: "{{ item['name'] }}"
        value: "{{ item['value'] }}"
      loop: "{{ git }}"
      tags: git
